<div class="dashboard-container">
  <h2>Add Expense</h2>

  <form [formGroup]="expenseForm" (ngSubmit)="onSubmit()">
    <!-- Form Fields -->
    <div class="form-group">
      <label for="amount">Amount:</label>
      <input type="number" id="amount" formControlName="amount" required />
    </div>

    <div class="form-group">
      <label for="category">Category:</label>
      <select id="category" formControlName="category" required>
        <option value="">-- Select Category --</option>
        <option value="Food">ğŸ” Food</option>
        <option value="Transport">ğŸšŒ Transport</option>
        <option value="Rent">ğŸ  Rent</option>
        <option value="Utilities">ğŸ’¡ Utilities</option>
        <option value="Shopping">ğŸ›ï¸ Shopping</option>
        <option value="Savings">ğŸ’° Savings</option>
        <option value="Social Life">ğŸ» Social Life</option>
        <option value="Pets">ğŸ¾ Pets</option>
        <option value="Culture">ğŸ­ Culture</option>
        <option value="Apparel">ğŸ‘— Apparel</option>
        <option value="Beauty">ğŸ’… Beauty</option>
        <option value="Health">ğŸ¥ Health</option>
        <option value="Gifts">ğŸ Gifts</option>
        <option value="Education">ğŸ“š Education</option>
        <option value="Other">ğŸ“¦ Other</option>
      </select>
    </div>

    <div class="form-group">
      <label for="date">Date:</label>
      <input type="date" id="date" formControlName="date" required />
    </div>

    <div class="form-group">
      <label for="title">Title:</label>
      <input type="text" id="title" formControlName="title" />
    </div>

    <div class="form-group">
      <label>
        <input type="checkbox" formControlName="isRecurring" />
        Recurring Monthly
      </label>
    </div>

    <div class="form-group" *ngIf="expenseForm.get('isRecurring')?.value">
      <label for="recurringDay">Recurring Day (1â€“31):</label>
      <input type="number" id="recurringDay" formControlName="recurringDay" min="1" max="31" />
    </div>

    <div class="form-group">
      <button type="submit" [disabled]="expenseForm.invalid">Add Expense</button>
    </div>
  </form>

  <p *ngIf="message">{{ message }}</p>

  <!-- Toggle Buttons -->
  <div style="text-align: center; margin-top: 30px;">
    <button (click)="showHistory = !showHistory">
      {{ showHistory ? 'Hide Expense History' : 'View Expense History' }}
    </button>
    <button (click)="showAnalytics = !showAnalytics" style="margin-left: 10px;">
      {{ showAnalytics ? 'Hide Analytics' : 'View Analytics' }}
    </button>
    <button (click)="showTopCategory = !showTopCategory" style="margin-left: 10px;">
      {{ showTopCategory ? 'Hide Top Category' : 'View Top Spending Category' }}
    </button>
    <button (click)="toggleYearlyAnalytics()" style="margin-left: 10px;">
      {{ showYearlyAnalytics ? 'Hide Yearly Analytics' : 'View Yearly Analytics' }}
    </button>
    <button (click)="downloadCsv()" style="margin-left: 10px;">Download CSV</button>
  </div>

  <!-- Expense History -->
  <div *ngIf="showHistory">
    <hr />
    <h3>Expense History</h3>
    <div *ngIf="expenses.length === 0">
      <p>No expenses added yet.</p>
    </div>
    <ul *ngIf="expenses.length > 0">
      <li *ngFor="let expense of expenses">
        <strong>{{ expense.date | date : 'yyyy-MM-dd' }}</strong> - â‚¹{{ expense.amount }}
        <span>({{ expense.category }})</span>
        <span *ngIf="expense.title"> - {{ expense.title }}</span>
        <span *ngIf="expense.isRecurring"> ğŸ”</span>
      </li>
    </ul>
  </div>

  <!-- Monthly Pie Chart -->
  <div *ngIf="showAnalytics && pieData.datasets[0].data.length > 0" style="margin-top: 20px;">
    <h3>ğŸ“Š Monthly Category-wise Expenses</h3>
    <canvas baseChart [data]="pieData" [type]="pieChartType" [labels]="pieLabels"></canvas>
  </div>

  <!-- Top Monthly Category -->
  <div *ngIf="showTopCategory && topCategory" style="margin-top: 30px; text-align: center;">
    <div style="border: 1px solid #ccc; padding: 15px; border-radius: 8px; max-width: 300px; margin: 0 auto;">
      <h3>ğŸ’¸ Top Spending Category</h3>
      <p style="font-size: 18px;">
        <strong>{{ topCategory.category }}</strong> â€“ â‚¹{{ topCategory.totalAmount }}
      </p>
    </div>
  </div>

  <!-- Yearly Analytics -->
  <div *ngIf="showYearlyAnalytics" style="margin-top: 20px;">
    <h3>ğŸ“… Yearly Category-wise Expenses</h3>

    <div style="margin-bottom: 10px;">
      <label for="yearSelect">Select Year: </label>
      <select id="yearSelect" [(ngModel)]="selectedYear" (change)="loadYearlySummary(); loadTopCategoryYearly();">
        <option *ngFor="let y of [2023, 2024, 2025]" [value]="y">{{ y }}</option>
      </select>
    </div>

    <canvas baseChart [data]="yearlyPieData" [type]="yearlyPieChartType" [labels]="yearlyPieLabels"></canvas>

    <div *ngIf="topCategoryYearly" style="margin-top: 20px;">
      <h4>Top Category for {{ selectedYear }}</h4>
      <p><strong>{{ topCategoryYearly.category }}</strong> - â‚¹{{ topCategoryYearly.totalAmount }}</p>
    </div>
  </div>
</div>
